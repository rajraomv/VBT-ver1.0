<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waking Up Library...</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Outfit:wght@300;400;600;800&display=swap"
        rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: url('images/baseframe.png') no-repeat center center fixed;
            background-size: cover;
            margin: 0;
            overflow: hidden;
            color: white;
        }

        .container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 60px 40px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            max-width: 500px;
            width: 90%;
        }

        .logo {
            width: 150px;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        h1 {
            font-family: 'Great Vibes', cursive;
            font-size: 3.5em;
            color: #FFD700;
            /* Gold */
            margin: 0 0 20px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        p {
            font-size: 1.2em;
            margin-bottom: 30px;
            line-height: 1.5;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #FFD700;
            margin: 0 auto 20px auto;
            animation: spin 1s ease-in-out infinite;
        }

        .status-text {
            font-size: 0.9em;
            color: #a8a8a8;
            font-style: italic;
            transition: opacity 0.5s ease-in-out;
            min-height: 1.5em;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <img src="images/logo.png" alt="Logo" class="logo">
        <h1>Namasthe! üôè</h1>
        <p>We are waking up the library for you.<br>Please wait a moment...</p>

        <div class="loader"></div>
        <div class="status-text" id="status">Waking up the library...</div>
    </div>

    <script>
        // ---------------------------------------------------------
        // CONFIGURATION
        // ---------------------------------------------------------
        const RENDER_URL = "https://vbt-ver1-0.onrender.com/";
        // We check for a specific asset that only exists when the app is fully running
        const PING_ASSET = "static/images/logo.png";
        const MIN_LOADING_TIME = 8000; // 8 seconds minimum show time (Increased for visibility)
        // ---------------------------------------------------------

        const messages = [
            "Lighting the lamps of knowledge... ü™î",
            "Dusting off the ancient scrolls... üìú",
            "Opening the gates to wisdom... ‚õ©Ô∏è",
            "Preparing your personal collection... üìö",
            "Almost there... ‚ú®"
        ];

        let msgIndex = 0;
        const statusDiv = document.getElementById('status');
        let intervalId;
        let startTime = Date.now();

        // 1. Start Rotating Messages
        intervalId = setInterval(() => {
            statusDiv.style.opacity = '0'; // Fade out
            setTimeout(() => {
                msgIndex = (msgIndex + 1) % messages.length;
                statusDiv.innerText = messages[msgIndex];
                statusDiv.style.opacity = '1'; // Fade in
            }, 500);
        }, 2500);

        // 2. Image Ping Function
        function checkServer() {
            // Enforce minimum loading time
            const elapsed = Date.now() - startTime;
            if (elapsed < MIN_LOADING_TIME) {
                setTimeout(checkServer, 1000);
                return;
            }

            // Try to load the logo image from the live server
            // We add a random query param to prevent caching
            const img = new Image();
            img.onload = function () {
                // If image loads, server is definitely UP and serving files!
                handleSuccess();
            };
            img.onerror = function () {
                // If image fails, server is down or starting up. Retry.
                console.log("Server not ready yet (Image check failed), retrying...");
                setTimeout(checkServer, 2000);
            };
            img.src = RENDER_URL + PING_ASSET + "?t=" + Date.now();
        }

        // 3. Success Handler
        function handleSuccess() {
            clearInterval(intervalId); // Stop rotating messages

            statusDiv.style.opacity = '0';
            setTimeout(() => {
                statusDiv.innerText = "Library Found! Entering...";
                statusDiv.style.color = "#10b981"; // Green
                statusDiv.style.fontWeight = "bold";
                statusDiv.style.opacity = '1';

                // Redirect after a brief pause to let user see the success message
                setTimeout(() => {
                    window.location.href = RENDER_URL;
                }, 1500);
            }, 500);
        }

        // Start the process
        checkServer();
    </script>
</body>

</html>