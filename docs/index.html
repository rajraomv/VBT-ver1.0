<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waking Up Library...</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Outfit:wght@300;400;600;800&display=swap"
        rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="images/logo.png">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: url('images/baseframe.png') no-repeat center center fixed;
            background-size: cover;
            margin: 0;
            overflow: hidden;
            color: white;
        }

        .container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 60px 40px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            max-width: 500px;
            width: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .logo {
            width: 150px;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        h1 {
            font-family: 'Great Vibes', cursive;
            font-size: 3.5em;
            color: #FFD700;
            /* Gold */
            margin: 0 0 20px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        p {
            font-size: 1.2em;
            margin-bottom: 30px;
            line-height: 1.5;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #FFD700;
            margin: 0 auto 20px auto;
            animation: spin 1s ease-in-out infinite;
        }

        .status-text {
            font-size: 0.9em;
            color: #a8a8a8;
            font-style: italic;
            transition: opacity 0.5s ease-in-out;
            min-height: 1.5em;
            margin-bottom: 20px;
        }

        /* Smart Launcher Buttons */
        .action-btn {
            background-color: white;
            color: #DAA520;
            /* Dark Goldenrod */
            font-family: 'Outfit', sans-serif;
            font-weight: bold;
            font-style: italic;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 1.1em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, box-shadow 0.2s, opacity 0.5s;
            text-decoration: none;
            display: none;
            /* Hidden by default */
            margin-top: 10px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* iOS Install Message */
        .ios-msg {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            /* High contrast white */
            color: #b8860b;
            /* Dark Goldenrod text */
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
            font-size: 1em;
            font-weight: 600;
            max-width: 80%;
            border: 2px solid #FFD700;
            /* Gold border */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            animation: float 4s ease-in-out infinite;
        }
    </style>
</head>

<body>
    <div class="container">
        <img src="images/logo.png" alt="Logo" class="logo">
        <h1>Namasthe! üôè</h1>
        <p>We are waking up the library for you.<br>Please wait a moment...</p>

        <div class="loader"></div>
        <div class="status-text" id="status">Waking up the library...</div>

        <!-- Smart Launcher Buttons -->
        <button id="install-btn" class="action-btn">Install This App</button>

        <!-- iOS Instructions -->
        <div id="ios-msg" class="ios-msg">
            To install on iPhone/iPad:<br>
            Tap the <strong>Share</strong> button <span style="font-size:1.2em">‚¨ÜÔ∏è</span><br>
            and select <strong>"Add to Home Screen"</strong> <span style="font-size:1.2em">‚ûï</span>
        </div>
    </div>

    <script>
        // ---------------------------------------------------------
        // CONFIGURATION
        // ---------------------------------------------------------
        const RENDER_URL = "https://vbt-ver1-0.onrender.com/";
        const PING_ASSET = "static/images/logo.png";
        const MIN_LOADING_TIME = 12000; // 12 seconds
        // ---------------------------------------------------------

        // 1. Detect Mode
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);

        const installBtn = document.getElementById('install-btn');
        const statusDiv = document.getElementById('status');
        const loader = document.querySelector('.loader');
        const iosMsg = document.getElementById('ios-msg');

        // PWA Install Prompt Logic
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // Only show install button if NOT in standalone mode
            if (!isStandalone) {
                installBtn.style.display = 'inline-block';
            }
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to the install prompt: ${outcome}`);
                deferredPrompt = null;
            }
        });

        const messages = [
            "Lighting the lamps of knowledge... ü™î",
            "Dusting off the ancient scrolls... üìú",
            "Opening the gates to wisdom... ‚õ©Ô∏è",
            "Preparing your personal collection... üìö",
            "Almost there... ‚ú®"
        ];

        let msgIndex = 0;
        let intervalId;
        let startTime = Date.now();

        // 2. Start Rotating Messages
        intervalId = setInterval(() => {
            statusDiv.style.opacity = '0';
            setTimeout(() => {
                msgIndex = (msgIndex + 1) % messages.length;
                statusDiv.innerText = messages[msgIndex];
                statusDiv.style.opacity = '1';
            }, 500);
        }, 2500);

        // 3. Image Ping Function
        function checkServer() {
            const elapsed = Date.now() - startTime;
            if (elapsed < MIN_LOADING_TIME) {
                setTimeout(checkServer, 1000);
                return;
            }

            const img = new Image();
            img.onload = function () {
                handleSuccess();
            };
            img.onerror = function () {
                console.log("Server not ready yet, retrying...");
                setTimeout(checkServer, 2000);
            };
            img.src = RENDER_URL + PING_ASSET + "?t=" + Date.now();
        }

        // 4. Success Handler
        function handleSuccess() {
            clearInterval(intervalId);

            statusDiv.style.opacity = '0';
            setTimeout(() => {
                statusDiv.innerText = "Library is Ready!";
                statusDiv.style.color = "#10b981"; // Green
                statusDiv.style.fontWeight = "bold";
                statusDiv.style.opacity = '1';

                // Hide loader
                loader.style.display = 'none';

                // UNIVERSAL AUTO-REDIRECT (App & Web)
                setTimeout(() => {
                    window.location.href = RENDER_URL;
                }, 1500);
            }, 500);
        }

        // Start
        checkServer();
    </script>
</body>

</html>